# Standalone PowerON Bot

–û–∫—Ä–µ–º–∏–π Telegram-–±–æ—Ç –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å –∑ `poweron.toe.com.ua`.

## –©–æ –≤–º—ñ—î –±–æ—Ç

- –ü–æ–∫—Ä–æ–∫–æ–≤–∏–π –ø–æ—à—É–∫ –∞–¥—Ä–µ—Å–∏: **–Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç ‚Üí –≤—É–ª–∏—Ü—è ‚Üí –±—É–¥–∏–Ω–æ–∫**.
- –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ —Å–∫—Ä—ñ–Ω—à–æ—Ç–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –≥—Ä–∞—Ñ—ñ–∫–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω—å.
- –ü–æ–∫–∞–∑ —á–µ—Ä–≥ –∑ API (–ì–ü–í, –ì–ê–í, –ê–ß–†, –ì–í–°–ü, –°–ì–ê–í).
- –Ü—Å—Ç–æ—Ä—ñ—è –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 3 –∞–¥—Ä–µ—Å.
- –ó–∞–∫—Ä—ñ–ø–ª–µ–Ω–Ω—è –¥–æ 3 –∞–¥—Ä–µ—Å –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.
- –ï–∫—Ä–∞–Ω **‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è** –∑ –∫–µ—Ä—É–≤–∞–Ω–Ω—è–º –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º.
- –ö–æ–º–∞–Ω–¥–∞ `/status` –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
- Self-test –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞: `/selftest_logs` (—Ç–µ—Å—Ç –∑–∞–ø–∏—Å—É –ª–æ–≥—ñ–≤) —ñ `/selftest_plot` (—Ç–µ—Å—Ç PNG-–≥—Ä–∞—Ñ—ñ–∫–∞ –≤ headless —Ä–µ–∂–∏–º—ñ).
- –ê–¥–º—ñ–Ω-–º–µ–Ω—é –∑ –∫–æ–º–∞–Ω–¥–∞–º–∏ `/stats`, `/broadcast`, `/health`, `/shutdown`, `/restart` (–ª–∏—à–µ –¥–ª—è –∞–¥–º—ñ–Ω–∞).
- `/broadcast` –ø—Ä–∞—Ü—é—î –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –ø–µ—Ä–µ–≥–ª—è–¥–æ–º —ñ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è–º –ø–µ—Ä–µ–¥ –º–∞—Å–æ–≤–æ—é —Ä–æ–∑—Å–∏–ª–∫–æ—é.
- –ê–¥–º—ñ–Ω-–º–µ–Ω—é –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–æ—é `/admin` –∞–±–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–ª—è –∞–¥–º—ñ–Ω–∞ –ø—ñ—Å–ª—è `/start`.
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Ö–æ–¥—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É –∞–±—Å–æ–ª—é—Ç–Ω–∏–π —Ñ–∞–π–ª `logs/user_entries.log` (–∞–≤—Ç–æ—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó `logs/`).
- –û–∫—Ä–µ–º–∏–π –∞—É–¥–∏—Ç –∞–¥–º—ñ–Ω-–¥—ñ–π —É –∞–±—Å–æ–ª—é—Ç–Ω–∏–π —Ñ–∞–π–ª `logs/admin_actions.log`.
- –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–Ω—ñ–π –ø–æ–º–∏–ª—Ü—ñ polling –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∑ –ø–∞—É–∑–æ—é 5 —Å–µ–∫—É–Ω–¥.
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å (—ñ—Å—Ç–æ—Ä—ñ—è/–∑–∞–∫—Ä—ñ–ø–ª–µ–Ω—ñ –∞–¥—Ä–µ—Å–∏) —É `data/users.json (–∫–ª—é—á—ñ ‚Äî chat_id)`, –≤–∫–ª—é—á–Ω–æ –∑ `auto_update` (enabled/interval/silent).
- –ó–∞–ø–∏—Å `data/users.json` –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ + –∑ backup —É `data/users.json.bak`.
- –ö–µ—à –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ —Å–ø—ñ–ª—å–Ω–∏–π –¥–ª—è –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (–±–µ–∑ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —Ä–µ–Ω–¥–µ—Ä—É –¥–ª—è –æ–¥–Ω—ñ—î—ó –∞–¥—Ä–µ—Å–∏).

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

```text
.
‚îú‚îÄ‚îÄ poweron_bot/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ client.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îî‚îÄ‚îÄ wizard.py
‚îú‚îÄ‚îÄ poweron_admin_user_id.txt.example
‚îú‚îÄ‚îÄ poweron_bot_token.txt.example
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

## –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –∑–∞–ø—É—Å–∫—É

### 1) –í—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```bash
pip install -r requirements.txt
python -m playwright install chromium
```

### Ubuntu 22.04 (–≤–∞–∂–ª–∏–≤–æ –¥–ª—è —Å–∫—Ä—ñ–Ω—à–æ—Ç—ñ–≤)

–Ø–∫—â–æ –Ω–∞ Ubuntu 22.04 –Ω–µ —Ñ–æ—Ä–º—É—î—Ç—å—Å—è —Å–∫—Ä—ñ–Ω—à–æ—Ç, –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —Å–∏—Å—Ç–µ–º–Ω–∏–π Chromium —ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ Playwright:

```bash
sudo apt update
sudo apt install -y chromium-browser
python -m playwright install chromium
python -m playwright install-deps chromium
```

–ó–∞ –ø–æ—Ç—Ä–µ–±–∏ –º–æ–∂–Ω–∞ —è–≤–Ω–æ –∑–∞–¥–∞—Ç–∏ —à–ª—è—Ö –¥–æ –±—Ä–∞—É–∑–µ—Ä–∞:

```bash
export POWERON_BROWSER_PATH="/usr/bin/chromium-browser"
```

> –î–ª—è Termux: –±–æ—Ç –ø—ñ–¥—Ç—Ä–∏–º—É—î HTTP-–∫–ª—ñ—î–Ω—Ç **httpx** –∞–±–æ **requests**. –Ø–∫—â–æ –∑ `httpx` —î –ø—Ä–æ–±–ª–µ–º–∞ —É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `requests` (–≤–∂–µ –¥–æ–¥–∞–Ω–æ –≤ `requirements.txt`).

### 2) –ù–∞–ª–∞—à—Ç—É–π —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

–ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è 2 —Å–ø–æ—Å–æ–±–∏ (–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –º–∞—î –∑–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è):

1. –ß–µ—Ä–µ–∑ ENV:

```bash
export POWERON_BOT_TOKEN="<YOUR_TELEGRAM_BOT_TOKEN>"
```

2. –ß–µ—Ä–µ–∑ —Ñ–∞–π–ª —É –∫–æ—Ä–µ–Ω—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é:

- –°–∫–æ–ø—ñ—é–π —à–∞–±–ª–æ–Ω `poweron_bot_token.txt.example` —É `poweron_bot_token.txt`.
- –í—Å—Ç–∞–≤ —Ç–æ–∫–µ–Ω –≤ **–æ–¥–∏–Ω —Ä—è–¥–æ–∫** –±–µ–∑ –ª–∞–ø–æ–∫.

> `poweron_bot_token.txt` –º–∞—î –±—É—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–º —Ñ–∞–π–ª–æ–º —ñ –Ω–µ –º–∞—î –∫–æ–º—ñ—Ç–∏—Ç–∏—Å—å —É git.

### 3) (–û–ø—Ü—ñ–π–Ω–æ) –æ–±–º–µ–∂ –¥–æ—Å—Ç—É–ø –¥–æ –±–æ—Ç–∞

```bash
export POWERON_ALLOWED_IDS="123456,987654"
```

–∞–±–æ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ª–∏—à–µ –∞–¥–º—ñ–Ω—É:

```bash
export POWERON_ADMIN_USER_ID="123456"
```

`POWERON_ALLOWED_IDS` –æ–±–º–µ–∂—É—î –¥–æ—Å—Ç—É–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –±–æ—Ç–∞.
`POWERON_ADMIN_USER_ID` (–∞–±–æ `poweron_admin_user_id.txt`) –≤–∏–∑–Ω–∞—á–∞—î –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –∞–¥–º—ñ–Ω-–∫–æ–º–∞–Ω–¥ `/admin`, `/stats`, `/health`, `/broadcast`.
–Ø–∫—â–æ –Ω–µ –∑–∞–¥–∞–≤–∞—Ç–∏ `POWERON_ALLOWED_IDS` ‚Äî –±–æ—Ç –¥–æ—Å—Ç—É–ø–Ω–∏–π —É—Å—ñ–º, —Ö—Ç–æ –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –Ω—å–æ–≥–æ –≤ Telegram.

## –ó–∞–ø—É—Å–∫

```bash
python -m poweron_bot.main
```

## –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

```bash
python -m compileall poweron_bot
```

## –õ–æ–≥–∏ —Ç–∞ self-test

- –õ–æ–≥–∏ –ø–∏—à—É—Ç—å—Å—è —É:
  - `/home/ubuntu/Poweron_bot/logs/admin_actions.log`
  - `/home/ubuntu/Poweron_bot/logs/user_entries.log`
- –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è `logs/` —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤: –≤–∏–∫–æ–Ω–∞–π—Ç–µ `/selftest_logs` –≤—ñ–¥ –∞–¥–º—ñ–Ω-–∞–∫–∞—É–Ω—Ç–∞, –ø–æ—Ç—ñ–º –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –æ–±–∏–¥–≤–∞ —Ñ–∞–π–ª–∏.
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ PNG-–≥—Ä–∞—Ñ—ñ–∫–∞: –≤–∏–∫–æ–Ω–∞–π—Ç–µ `/selftest_plot` –≤—ñ–¥ –∞–¥–º—ñ–Ω-–∞–∫–∞—É–Ω—Ç–∞ ‚Äî –±–æ—Ç –Ω–∞–¥—ñ—à–ª–µ —Ç–µ—Å—Ç–æ–≤–∏–π PNG, –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ matplotlib backend `Agg`.

## –ü–æ—à–∏—Ä–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

- **`Set POWERON_BOT_TOKEN or create poweron_bot_token.txt`**  
  –ù–µ –∑–∞–¥–∞–Ω–æ —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ ENV —ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π —Ñ–∞–π–ª `poweron_bot_token.txt`.

- **Playwright –Ω–µ –∑–∞–ø—É—Å–∫–∞—î Chromium (–æ—Å–æ–±–ª–∏–≤–æ Ubuntu 22.04)**  
  –í–∏–∫–æ–Ω–∞–π: `python -m playwright install chromium && python -m playwright install-deps chromium`, –≤—Å—Ç–∞–Ω–æ–≤–∏ `chromium-browser` —ñ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –∑–∞–¥–∞–π `POWERON_BROWSER_PATH=/usr/bin/chromium-browser`.

- **`ModuleNotFoundError` –Ω–∞ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è—Ö**  
  –ü–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤–∏ –ø–∞–∫–µ—Ç–∏: `pip install -r requirements.txt`.


## –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- –ù–∞ –≥–æ–ª–æ–≤–Ω–æ–º—É –µ–∫—Ä–∞–Ω—ñ reply-–º–µ–Ω—é: **"üí° –ì—Ä–∞—Ñ—ñ–∫ —Å–≤—ñ—Ç–ª–∞"**, **"üìå –ó–∞–∫—Ä—ñ–ø–ª–µ–Ω—ñ"**, **"üïò –Ü—Å—Ç–æ—Ä—ñ—è"**, **"‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"**, **"‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å"**, **"üè† –ì–æ–ª–æ–≤–Ω–∞"**.
- Inline –∑–∞–ª–∏—à–∏–≤—Å—è –ª–∏—à–µ —Ç–∞–º, –¥–µ —Ü–µ –∫—Ä–∏—Ç–∏—á–Ω–æ: –≤–∏–±—ñ—Ä –∞–¥—Ä–µ—Å–∏ –∑—ñ —Å–ø–∏—Å–∫—É —Ç–∞ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –¥—ñ—ó –∑ —ñ—Å—Ç–æ—Ä—ñ—î—é/–∑–∞–∫—Ä—ñ–ø–ª–µ–Ω–∏–º–∏ –∞–¥—Ä–µ—Å–∞–º–∏.
- –ü—ñ—Å–ª—è –≤–∏–±–æ—Ä—É –∞–¥—Ä–µ—Å–∏ –±–æ—Ç –Ω–∞–¥—Å–∏–ª–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è **"‚è≥ –û—á—ñ–∫—É–π—Ç–µ..."** –ø—ñ–¥ —á–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫–∞.
- –î–æ—Å—Ç—É–ø–Ω–µ –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫–∞: **—É–≤—ñ–º–∫–Ω—É—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏**, –ø—Ä–µ—Å–µ—Ç–∏ **30—Å / 60—Å / 120—Å** —ñ –≤–ª–∞—Å–Ω–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª (–º—ñ–Ω—ñ–º—É–º 10—Å).
- –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ —Ç–∏—Ö–æ–º—É —Ä–µ–∂–∏–º—ñ –Ω–∞–¥—Å–∏–ª–∞—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ª–∏—à–µ –∫–æ–ª–∏ –≥—Ä–∞—Ñ—ñ–∫ –∑–º—ñ–Ω–∏–≤—Å—è (–±–µ–∑ —Å–ø–∞–º—É).
- –î—ñ—î rate-limit –Ω–∞ —á–∞—Å—Ç—ñ –∑–∞–ø–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —â–æ–± –Ω–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ API.
- –ù–∞—Ç–∏—Å–∫–∞–Ω–Ω—è **"üí° –ì—Ä–∞—Ñ—ñ–∫ —Å–≤—ñ—Ç–ª–∞ (–∑–∞ –∞–¥—Ä–µ—Å–æ—é)"** –∑–∞–≤–∂–¥–∏ —Å–∫–∏–¥–∞—î —Å—Ü–µ–Ω–∞—Ä—ñ–π —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –≤ –ø–æ—á–∞—Ç–æ–∫ –ø–æ—à—É–∫—É –∞–¥—Ä–µ—Å–∏.
- –ö–æ–º–∞–Ω–¥–∞ `/status` –ø–æ–∫–∞–∑—É—î –∞–∫—Ç–∏–≤–Ω–µ –∞–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è, —ñ–Ω—Ç–µ—Ä–≤–∞–ª, —Ä–µ–∂–∏–º —ñ –æ—Å—Ç–∞–Ω–Ω—é –∞–¥—Ä–µ—Å—É.

## –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π systemd unit

```ini
[Unit]
Description=PowerON Telegram Bot
After=network.target

[Service]
Type=simple
WorkingDirectory=/home/ubuntu/Poweron_bot
Environment=PYTHONUNBUFFERED=1
ExecStart=/home/ubuntu/Poweron_bot/.venv/bin/python -m poweron_bot.main
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

> –í–∞–∂–ª–∏–≤–æ: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Python –∑ –≤–∞—à–æ–≥–æ venv —ñ –∑–∞–ø—É—Å–∫ –º–æ–¥—É–ª–µ–º `-m poweron_bot.main`, —â–æ–± —ñ–º–ø–æ—Ä—Ç–∏ –ø—Ä–∞—Ü—é–≤–∞–ª–∏ —Å—Ç–∞–±—ñ–ª—å–Ω–æ.
